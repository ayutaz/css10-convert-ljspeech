# CSS10 to LJSpeech Converter

CSS10データセットをLJSpeechフォーマットに変換するツールです。

## 概要

このプロジェクトは、複数の言語で構成されたCSS10音声データセットを、音声合成モデルの訓練に適したLJSpeechフォーマットに変換します。

## データセット情報

CSS10データセットは以下の10言語で構成されています：

- **de** (ドイツ語): 7,427ファイル (11.6%)
- **el** (ギリシャ語): 1,844ファイル (2.9%)
- **es** (スペイン語): 11,016ファイル (17.2%)
- **fi** (フィンランド語): 4,842ファイル (7.5%)
- **fr** (フランス語): 8,649ファイル (13.5%)
- **hu** (ハンガリー語): 4,514ファイル (7.0%)
- **ja** (日本語): 6,839ファイル (10.7%)
- **nl** (オランダ語): 6,494ファイル (10.1%)
- **ru** (ロシア語): 9,599ファイル (15.0%)
- **zh** (中国語): 2,971ファイル (4.6%)

**総計**: 64,195ファイル (約41.5GB)

## 環境構築

### 前提条件

- Python 3.8以上
- uv (Pythonパッケージマネージャー)

### セットアップ

```bash
# 仮想環境を作成
uv venv .venv

# 仮想環境をアクティベート
.venv\Scripts\activate  # Windows
source .venv/bin/activate  # Linux/Mac

# 依存関係をインストール
uv pip install pandas tqdm
```

## 使用方法

### 1. データの準備

`data/`ディレクトリに以下の構造でCSS10データセットを配置してください：

```
data/
├── archive (1)/     # ドイツ語
├── archive (2)/     # ギリシャ語
├── archive (3)/     # スペイン語
├── archive (4)/     # フィンランド語
├── archive (5)/     # フランス語
├── archive (6)/     # ハンガリー語
├── archive (7)/     # 日本語
├── archive (8)/     # オランダ語
├── archive (9)/     # ロシア語
└── archive (10)/    # 中国語
```

各アーカイブディレクトリには以下のファイルが含まれている必要があります：
- `transcript.txt`: 音声ファイルとテキストの対応表
- 音声ファイル（.wav形式）

### 2. 変換の実行

```bash
python convert_to_ljspeech.py
```

### 3. 結果の確認

変換が完了すると、`raw/`ディレクトリに以下のファイルが生成されます：

```
raw/
├── wavs/           # 音声ファイル（言語コード付きファイル名）
└── metadata.csv    # メタデータファイル
```

## 出力フォーマット

### ファイル名形式

```
{言語コード}_{元のファイル名}.wav
```

例：
- `de_achtgesichterambiwasse_0000.wav`
- `ja_meian_0000.wav`
- `zh_call_to_arms_0000.wav`

### メタデータ形式

LJSpeechフォーマットに準拠したCSVファイル：

```
ファイル名|言語コード|文字起こし
```

例：
```
de_achtgesichterambiwasse_0000|de|Hanake hatte allen Körperschmuck, den ein japanisches Mädchen sitzend, trippelnd und liegend zeigen muß,
ja_meian_0000|ja|この前探った時は、途中に瘢痕の隆起があったので、ついそこが行きどまりだとばかり思って、ああ云ったんですが、
zh_call_to_arms_0000|zh|阿Q不独是姓名籍贯有些渺茫，连他先前的"行状"也渺茫。
```

## スクリプトの説明

### メインスクリプト

- `convert_to_ljspeech.py`: メイン変換スクリプト
- `test_single_archive.py`: 単一アーカイブのテスト用スクリプト
- `analyze_results.py`: 変換結果の分析スクリプト
- `update_metadata_format.py`: メタデータ形式更新スクリプト

### 機能

- **自動言語検出**: アーカイブ名から言語コードを自動判定
- **重複排除**: 同じファイル名の重複を自動スキップ
- **エラーハンドリング**: ファイルが見つからない場合の適切な処理
- **進捗表示**: tqdmによる進捗バー表示
- **統計情報**: 処理結果の詳細な統計情報

## 話者情報

CSS10データセットでは、各言語につき1人の話者（ナレーター）が音声を録音しています：

- **de**: ドイツ語話者1名
- **ja**: 日本語話者1名
- **en**: 英語話者1名
- **es**: スペイン語話者1名
- など...

メタデータの言語コード部分は、各言語の話者を識別するために使用されます。

## トラブルシューティング

### よくある問題

1. **ファイルが見つからない**
   - データディレクトリの構造を確認
   - ファイルパスの区切り文字（/ vs \）を確認

2. **メモリ不足**
   - 大量のファイルを処理する際は十分なメモリを確保

3. **エンコーディングエラー**
   - transcript.txtの文字エンコーディングをUTF-8に統一

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能要望は、GitHubのIssuesページでお知らせください。 